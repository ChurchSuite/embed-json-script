document.addEventListener("alpine:init",()=>{Alpine.data("CSEvents",()=>({allEvents:[],categories:[],category:"",events:[],featuredEvents:[],search:"",site:"",sites:[],async init(){this.$watch(["category","search","site"],()=>this.filterEvents());let t=(await CS.fetchJSON("events")).filter(t=>"1"==t.signup_options.public.featured),s=[];t.forEach(t=>{null==t.category||this.categories.includes(t.category.name)||this.categories.push(t.category.name),null==t.site||this.sites.includes(t.site.name)||this.sites.push(t.site.name);var e=CS.timeFormat(t.datetime_start)+" - "+CS.timeFormat(t.datetime_end),e={_original:t,allDay:"12:00am - 11:59:59pm"==e,brandEmblem:t.brand.emblem,category:null!=t.category?t.category.name:null,description:CS.stringToHTML(t.description),date:new Date(t.datetime_start.replace(/-/g,"/")).toLocaleDateString("en-GB",{weekday:"long",month:"long",day:"numeric"}),shortDate:new Date(t.datetime_start.replace(/-/g,"/")).toLocaleDateString("en-GB",{weekday:"short",month:"short",day:"numeric"}),image:t.images.constructor===Object?t.images.md.url:t.brand.emblem,link:1==t.signup_options.signup_enabled?t.signup_options.tickets.url:"",location:t.location.name,name:t.name,postcode:t.location.address,site:null!=t.site?t.site.name:null,time:e};s.includes(t.name)||(this.events.push(e),s.push(t.name)),this.allEvents.push(e)}),this.featuredEvents=this.events},filterEvents(){this.search.length||this.category.length||this.site.length?this.events=this.allEvents.filter(t=>{var e=!this.search.length||(t.name+t.date+t.location+t.category).toLowerCase().includes(this.search.toLowerCase()),s=!this.category.length||t.category===this.category,t=null==t.site||(!this.site.length||t.site==this.site);return s&&e&&t}):this.events=this.featuredEvents}})),Alpine.data("CSGroups",()=>({allFormattedGroups:[],cluster:"",clusters:[],day:"",days:[],groups:[],options:{show_tags:1},search:"",site:"",sites:[],tag:"",tags:[],async init(){this.$watch(["day","tag","search","site","cluster"],()=>this.filterGroups());let t=await CS.fetchJSON("groups",this.options);this.days=CS.days(),t.forEach(t=>{null==t.site||this.sites.includes(t.site.name)||this.sites.push(t.site.name),null==t.cluster||this.clusters.includes(t.cluster.name)||this.clusters.push(t.cluster.name),null!=t.tags&&t.tags.forEach(t=>{this.tags.includes(t.name)||this.tags.push(t.name)}),this.sites.sort(),this.clusters.sort(),this.tags.sort(),this.allFormattedGroups.push({cluster:null!=t.cluster?t.cluster.name:null,customFields:t.custom_fields.constructor===Object?this.buildCustomFields(t):null,dateStart:new Date(t.date_start.replace(/-/g,"/")).toLocaleDateString("en-GB",{month:"short",year:"numeric"}),day:CS.days()[t.day],description:t.description.replace(/\r\n/g,"<br>"),frequency:t.frequency,image:t.images.constructor===Object?t.images.md.url:"",link:"https://"+CS.url+"/groups/"+t.identifier,location:t.location.name,name:t.name,online:"online"==t.location.type,site:null!=t.site?t.site.name:null,tags:t.tags,time:CS.timeFormat("1970-01-01 "+t.time),_original:t})}),this.groups=this.allFormattedGroups},buildCustomFields(s){let i=[];return Object.entries(s.custom_fields).forEach(t=>{const e=t[1];e.constructor===Object&&e.hasOwnProperty("formatted_value")&&e.settings.embed.view&&i.push({id:e.id,name:e.name,value:e.formatted_value,_original:[s.custom_fields["custom"+e.id],s.custom_fields["field"+e.id],s.custom_fields["field_"+e.id]]})}),i},filterGroups(){this.groups=this.allFormattedGroups.filter(t=>{var e=(null!=t.cluster||!this.cluster.length)&&(!this.cluster.length||t.cluster==this.cluster),s=!this.day.length||t.day==this.day,i=!this.tag.length||t.tags.map(t=>t.name).includes(this.tag),a=!this.search.length||t.name.toLowerCase().includes(this.search.toLowerCase()),t=null==t.site||(!this.site.length||t.site==this.site);return s&&i&&a&&t&&e})}}))}),window.CS={buildOptions:function(t){return 0!==Object.keys(t).length?"?"+new URLSearchParams(t).toString():""},days:function(){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},fetchJSON:async function(e,t={}){let s;var i=localStorage.getItem(e);return null!=i&&JSON.parse(i).expires>(new Date).getTime()?s=JSON.parse(i).json:await fetch("https://"+CS.url+"/embed/"+("events"==e?"calendar":"smallgroups")+"/json"+this.buildOptions(t)).then(t=>t.json()).then(t=>{localStorage.setItem(e,JSON.stringify({expires:(new Date).getTime()+9e5,json:t})),s=t}),s},stringToHTML:function(t){return div=document.createElement("div"),div.innerHTML=t,div.textContent||div.innerText||""},timeFormat:function(t){return new Date(t.replace(/-/g,"/")).toLocaleTimeString("en-GB",{hourCycle:"h12"}).replace(/ /g,"").replace(":00","")}};